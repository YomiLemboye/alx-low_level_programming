More functions and nestd loops
